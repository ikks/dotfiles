#!/bin/bash

# Translates from english to spanish using marian and opus
# it's expected that a servopustmmarian is running locally
# on port 7002
#
# No warranties
# 
# Igor TÃ¡mara
#
# To public domain
# 
# You can use this script as:
#
# echo "this will be translated to spanish"  | translatewithmarian

SERVER="localhost"
PORT=7002

API_URL="http://$SERVER:$PORT/api/translate"

function procesa() {
  JSON_DATA='{"source" : "'$1'" , "from" : "en", "to": "es"}'
  TRANSLATION=$(curl -s "$API_URL" -X POST -H 'Content-Type: application/json' -d "$JSON_DATA"  | jq -r '.translation')
  if [ -z "$TRANSLATION" ]; then
    echo Make sure to start the server: servopustmmarian
    return 0
  else
    echo $TRANSLATION
    return 1
  fi
}

input="-"
entrada=$(cat "$input")
procesa "$entrada"
